<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>光银网</title>
    <link rel="stylesheet" href="../lib/mui.css">
</head>
<style>
    .shopCartItem {
        padding: 5vw;
        background-color: #fff;
    }
</style>

<body>
    <div class="mui-content">
        <div class="shopCart" id="shopCart">
            <div class="shopCartItem">
                <div class="mui-input-row mui-checkbox mui-left">
                    <label>
                        <div>
                            <span>名字：
                                <i>秦星星</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                        <div>
                            <span>价格：
                                <i class="shopPrice">&yen;1235</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                    </label>
                    <input name="checkbox1" value="Item 1" type="checkbox" class="iptSelect" lang="1">
                </div>
            </div>
            <div class="shopCartItem">
                <div class="mui-input-row mui-checkbox mui-left">
                    <label>
                        <div>
                            <span>名字：
                                <i>秦星星</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                        <div>
                            <span>价格：
                                <i class="shopPrice">&yen;1235</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                    </label>
                    <input name="checkbox1" value="Item 1" type="checkbox" class="iptSelect" lang="2">
                </div>
            </div>
            <div class="shopCartItem">
                <div class="mui-input-row mui-checkbox mui-left">
                    <label>
                        <div>
                            <span>名字：
                                <i>秦星星</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                        <div>
                            <span>价格：
                                <i class="shopPrice">&yen;1235</i>
                            </span>
                            <span>电话：
                                <i>13685456214</i>
                            </span>
                        </div>
                    </label>
                    <input name="checkbox1" value="Item 1" type="checkbox" class="iptSelect" lang="3">
                </div>
            </div>
            <div class="mui-bar mui-bar-tab">
                <p class="totalPrice">
                    合计:
                    <span id="totalPrice">&yen;0</span>
                </p>
                <p class="buyNow">
                    <button id="buyNowBtn" class="buyNowBtn" disabled="disabled">立即购买</button>
                </p>
            </div>
            <div></div>
        </div>
    </div>
</body>
<script src="../lib/mui.js"></script>
<script src="../lib/jquery.min.js"></script>
<script>
    mui.init();
    /* *
     * 点击头部的编辑部分
     * */
    //获取到当前商品ID，以便购买时将商品信息发送到服务器

    var goodsIdArr = [];
    var goodId;
    //所勾选商品的价格
    var priceArr = [];
    var price = 0;
    mui(document.body).on('change', '.iptSelect', function () {
        //购物车中复选框
        var iptSelect = document.getElementsByClassName('iptSelect');
        //判断是否选择
        var checked = false;

        //添加之前先清空数组，防止之前添加的还在，
        //比如当你已经勾选了了四个，现在要放弃两个，那么那个就不应该再在这里面
        goodsIdArr.splice(0, goodsIdArr.length);
        priceArr.splice(0, priceArr.length);
        for (var j = 0; j < iptSelect.length; j++) {
            if (iptSelect[j].checked) {
                //如果勾选了获取所勾选商品的ID和价格
                goodId = parseInt(iptSelect[j].getAttribute('lang'));
                console.log(goodId)
                // priceStr = iptSelect[j].parentNode.children[2].children[1].innerHTML;
                priceStr = $(iptSelect[j]).parents(".mui-checkbox").find(".shopPrice").text();
                // console.log(priceStr)
                var reg = /[0-9]+/g;
                //将&yen;符号过滤，并且强制转换为数字类型
                price = parseInt(priceStr.match(reg));
                //如果不为空，且已经不存在于数组，才添加至数组
                if (goodId != undefined && goodsIdArr.indexOf(goodId) == -1　) {
                    goodsIdArr.push(goodId);
                    priceArr.push(price);
                    console.log(priceArr)
                }
            }
        }
        //总计
        var totalPrice = 0;
        for (var z = 0; z < priceArr.length; z++) {
            totalPrice = totalPrice + priceArr[z];
        }
        document.getElementById("totalPrice").innerHTML = '&yen;<i>' + totalPrice + '</i>';

        //获取当前有INPUT框勾选，如有则将buyNowBtn设为可用的
        for (var i = 0; i < iptSelect.length; i++) {
            if (iptSelect[i].checked) {
                checked = true;
                mui('#buyNowBtn')[0].disabled = false;
                //第一次，没有return，结果只有勾选最后一个才有效，
                //因为，无论你勾选了多少个，只要最后一个不勾选，
                //当循环到最后时，checked都会变为false,即立即购买都会变为禁用，
                //按道理来讲，只要查询到有勾选的，则将其设为可用，跳出循环。
                return;
            } else {
                checked = false;
                mui('#buyNowBtn')[0].disabled = true;
            }
        }
    });

    //用于后来的提交表单的交互
    $('#buyNowBtn').on("tap", function () {
        console.log(goodsIdArr)
        console.log($(totalPrice).find("i").text())
    })

    function toPage(uri) {
        mui.openWindow({
            url: uri,
            show: {
                autoShow: true,
                aniShow: "slide-in-right",
                duration: "200"
            },
            createNew: true
        });
    }
</script>

</html>